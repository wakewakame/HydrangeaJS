<!DOCTYPE html>
<html>
<head>
	<!-- Select Text Encode -->
	<meta content="ja" http-equiv="Content-Language" />
	<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
	<!-- Set Resolution -->
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<!-- full screen on iOS browser -->
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<!-- title -->
	<title>NodeShader</title>

	<script type="text/javascript" src="../dst/hydrangea.js"></script>
	<script src="https://pagecdn.io/lib/ace/1.4.5/ace.js" integrity="sha256-5Xkhn3k/1rbXB+Q/DX/2RuAtaB4dRRyQvMs83prFjpM=" crossorigin="anonymous"></script>
	<script type="text/javascript">
		const Page = HydrangeaJS.GUI.Page.Page;
		const NodeCanvas = HydrangeaJS.GUI.Templates.NodeCanvas;
		const TimeNode = HydrangeaJS.Extra.ShaderNode.TimeNode;
		const PictureNode = HydrangeaJS.Extra.ShaderNode.PictureNode;
		const ShaderNode = HydrangeaJS.Extra.ShaderNode.ShaderNode;
		const FrameNode = HydrangeaJS.Extra.ShaderNode.FrameNode;

		const init = (page) => {
			const shaderEditorElement = page.addElement("div", 0.0, 0.5, 1.0, 1.0, {
				"background": "#FFFFFF80",
				"display": "none"
			});
			shaderEditorElement.id = "shader_editor";
			const editor = ace.edit(shaderEditorElement.id);
			editor.setTheme("ace/theme/tomorrow");
			editor.setOptions({
				fontSize: "14pt"
			});
			editor.getSession().setMode("ace/mode/glsl");
			editor.on("change", (e) => {
				if (this.childs.length > 0) {
					if (this.childs[0] instanceof ShaderNode) {
						const code = this.editor.getValue();
						if (
							code !== "" &&
							code !== this.childs[0].compileState.code
						) this.childs[0].loadShader(code);
					}
				}
			});
			let node0 = page.addComponent(new TimeNode(30 + 250 * 0, 300));
			let node1 = page.addComponent(new PictureNode("lenna", "./lenna.png", 30 + 250 * 0, 30));
			let node2 = page.addComponent(new ShaderNode  ("rotate", 30 + 250 * 1, 150, 500));
			let node3 = page.addComponent(new FrameNode  ("result1", 30 + 250 * 2, 30, 512, 512));
			let node4 = page.addComponent(new ShaderNode  ("colorful", 30 + 250 * 3, 150, 500));
			let node5 = page.addComponent(new FrameNode  ("result2", 30 + 250 * 4, 30, 512, 512));

		};
		const loop = (page) => {
			page.subRootComponent.reset();
			page.subRootComponent.job();
		};
		const drop = (page, files) => {
			for(let file of files) {
				let url = window.URL.createObjectURL(file);
				page.addComponent(new PictureNode(file.name, url, 30 + 170 * 0, 30));
			}
		};

		const page = new Page(init, loop, 60.0, drop, NodeCanvas);
	</script>
</head>
<body>
</body>
</html>
